(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{361:function(t,a,e){"use strict";e.r(a);var s=e(42),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"policy-marker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#policy-marker"}},[t._v("#")]),t._v(" Policy Marker")]),t._v(" "),e("p",[t._v("The marker is a way to inject dynamic values into a policy. Depending on the library, various markers are supported by default. However, it is really easy to add customer markers. You can find more details about this on the respective language library reference page.")]),t._v(" "),e("p",[t._v("The marker is declared with the leading dollar sign "),e("code",[t._v("$")]),t._v(" and wrapped in curly brackets "),e("code",[t._v("{…}")]),t._v(". It consists of two parts. The source of data (marker name) and data path delimited by a dot "),e("code",[t._v(".")]),t._v(". For example, if you need to get the current user’s email, you can use the "),e("code",[t._v("${USER.user_email}")]),t._v(" marker.")]),t._v(" "),e("p",[t._v("The data path can be complex to give you more flexibility to define its true nature. For example, you can use square brackets "),e("code",[t._v("[]")]),t._v(" to access an array element by index or get a deeply nested property in the multi-level object. These are just a few examples of valid paths:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("${CONTEXT.Players[0].profile.name}")])]),t._v(" "),e("li",[e("code",[t._v('${USER.address["physical"].zip}')])]),t._v(" "),e("li",[e("code",[t._v("${MAP.Country[USA][NC][Charlotte]}")])]),t._v(" "),e("li",[e("code",[t._v("${PURCHASE.0929431.amount}")])])]),t._v(" "),e("p",[t._v("Almost in all instances, a policy marker is expected to be a string unless it is explicitly "),e("a",{attrs:{href:"#type-casting"}},[t._v("type cast")]),t._v(" to a different data type.")]),t._v(" "),e("p",[t._v("Markers can be used for two main purposes:")]),t._v(" "),e("ul",[e("li",[t._v("Define dynamically "),e("RouterLink",{attrs:{to:"/overview/policy-statement.html#resource"}},[t._v("resources")]),t._v(" or "),e("RouterLink",{attrs:{to:"/overview/policy-param.html"}},[t._v("params")])],1),t._v(" "),e("li",[t._v("Inject dynamically values before evaluating "),e("RouterLink",{attrs:{to:"/overview/policy-condition.html"}},[t._v("conditions")])],1)]),t._v(" "),e("p",[t._v("The main difference is that resources and params are compiled once when JSON policy manager is instantiated and conditions are evaluated every single time JSON policy manager is invoked. That is why any conditional statement or param that contains dynamic markers, can be both applicable and not within the same application execution if dynamic markers' values changed.")]),t._v(" "),e("h2",{attrs:{id:"type-casting"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#type-casting"}},[t._v("#")]),t._v(" Type Casting")]),t._v(" "),e("p",[t._v("The typecasting is extremely important to improve the quality of conditions as it allows you to explicitly convert data points to very specific data types before condition evaluates.")]),t._v(" "),e("p",[t._v("For developers that used to work with strongly typed programming languages (e.g. Java, C#, or C++), this is already second nature. However, for engineers that primarily focus on loosely typed languages (e.g. PHP or JavaScript), typecasting can be taken for granted as most of the time they do not have to worry about data types.")]),t._v(" "),e("p",[t._v("Disregarding what is your background, it is strongly encouraged to typecast markers' values to expected data types especially within conditions. This will significantly reduce the chances of any unexpected logical bugs.")]),t._v(" "),e("p",[t._v("By default JSON policy framework supports type casting fo the following data types:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("(*string)")]),t._v(" - convert value to string")]),t._v(" "),e("li",[e("code",[t._v("(*int)")]),t._v(" - convert numeric value to integer")]),t._v(" "),e("li",[e("code",[t._v("(*float)")]),t._v(" - convert decimal value to float")]),t._v(" "),e("li",[e("code",[t._v("(*bool)")]),t._v(" or "),e("code",[t._v("(*boolean)")]),t._v(" - convert boolean value representations (varies by language) to true or false")]),t._v(" "),e("li",[e("code",[t._v("(*array)")]),t._v(" - convert value to array")]),t._v(" "),e("li",[e("code",[t._v("(*json)")]),t._v(" - decode valid JSON string to array or object (depending on programming language)")]),t._v(" "),e("li",[e("code",[t._v("(*null)")]),t._v(" - convert null or empty values to null")]),t._v(" "),e("li",[e("code",[t._v("(*date)")]),t._v(" - convert value to date object")]),t._v(" "),e("li",[e("code",[t._v("(*ip)")]),t._v(" - convert a readable IP address into a packed format")])]),t._v(" "),e("p",[t._v("The custom typecasting can be easily added and for more information, check the respective language reference page.")]),t._v(" "),e("p",[t._v("Most condition types that work with scalar operands (e.g. "),e("RouterLink",{attrs:{to:"/overview/policy-condition.html#equals"}},[t._v("Equals")]),t._v(" or "),e("RouterLink",{attrs:{to:"/overview/policy-condition.html#in"}},[t._v("In")]),t._v("), do a literal comparison, that is why it is some important to make sure that values are typecasted accordingly.")],1),t._v(" "),e("p",[t._v("For example, the below statement will not be applicable without proper typecasting because HTTP query params are all strings.")]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Statement"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"allow"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Page:hello-world"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Condition"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Equals"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"(*int)${HTTP_QUERY.preview}"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"dynamic-mapping"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dynamic-mapping"}},[t._v("#")]),t._v(" Dynamic Mapping")]),t._v(" "),e("p",[t._v("From the policy "),e("RouterLink",{attrs:{to:"/overview/policy-statement.html#resource"}},[t._v("resources")]),t._v(" or "),e("RouterLink",{attrs:{to:"/overview/policy-param.html"}},[t._v("params")]),t._v(" you have the way to dynamically declare multiple instances from the array of scalar values.")],1),t._v(" "),e("p",[t._v("When JSON policy parser detects the reserved construct "),e("code",[t._v("=>")]),t._v(" then it assumes that the left side of the expression contains template name with "),e("code",[t._v("%s")]),t._v(" part that is going to be replaced with each scalar value from the right side value.")]),t._v(" "),e("p",[t._v("Let's analyze a couple of examples.")]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Param"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Key"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"country:%s:status => ${ARGS.active_countries}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Value"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"active"')]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("Some "),e("code",[t._v("active_countries")]),t._v(" property that is fetched from the context may contain an array of country names like "),e("code",[t._v("Array(Sudan, Yemen, Turkey)")]),t._v(" and JSON policy parser will declare 3 separate params accordingly. Based on this example, the equivalent for the above policy is the following one:")]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Param"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Key"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"country:Sudan:status"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Value"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"active"')]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Key"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"country:Yemen:status"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Value"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"active"')]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Key"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"country:Turkey:status"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Value"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"active"')]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("You can also declare an inline array of values to reduce the size of policies if you know ahead of all the desired values.")]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Param"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Key"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"player:position:%s => (*json)[1, 2, 3]"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Value"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);